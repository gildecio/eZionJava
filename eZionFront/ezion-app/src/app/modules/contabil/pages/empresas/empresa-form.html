<div class="empresas-container form-page">
  <div class="form-header">
    <h1 class="form-title">{{ editandoId ? 'Editar Empresa' : 'Nova Empresa' }}</h1>
  </div>

  <form [formGroup]="form" (ngSubmit)="salvar()" class="empresas-form">
    <!-- Abas de formulário -->
    <div class="form-tabs">
      <button type="button" class="tab-btn active" data-tab="dados-basicos" (click)="mudarAba('dados-basicos')">Dados Básicos</button>
      <button type="button" class="tab-btn" data-tab="endereco" (click)="mudarAba('endereco')">Endereço</button>
      <button type="button" class="tab-btn" data-tab="fiscal" (click)="mudarAba('fiscal')">Fiscal</button>
      <button type="button" class="tab-btn" data-tab="responsavel" (click)="mudarAba('responsavel')">Responsável</button>
    </div>

    <!-- Tab: Dados Básicos -->
    <div class="tab-content active" data-tab="dados-basicos">
      <div class="form-group" [class.has-error]="temErro('razaoSocial')">
        <label for="razaoSocial">Razão Social *</label>
        <input
          type="text"
          id="razaoSocial"
          formControlName="razaoSocial"
          class="form-input"
          placeholder="Ex: Empresa LTDA"
          (blur)="form.get('razaoSocial')?.markAsTouched()"
        />
        <span class="error-message" *ngIf="temErro('razaoSocial')">
          {{ obterMensagemErro('razaoSocial') }}
        </span>
      </div>

      <div class="form-group" [class.has-error]="temErro('nomeFantasia')">
        <label for="nomeFantasia">Nome Fantasia *</label>
        <input
          type="text"
          id="nomeFantasia"
          formControlName="nomeFantasia"
          class="form-input"
          placeholder="Ex: Minha Empresa"
          (blur)="form.get('nomeFantasia')?.markAsTouched()"
        />
        <span class="error-message" *ngIf="temErro('nomeFantasia')">
          {{ obterMensagemErro('nomeFantasia') }}
        </span>
      </div>

      <div class="form-row">
        <div class="form-group" [class.has-error]="temErro('cnpj')">
          <label for="cnpj">CNPJ *</label>
          <input
            type="text"
            id="cnpj"
            formControlName="cnpj"
            class="form-input"
            placeholder="00.000.000/0000-00"
            (blur)="form.get('cnpj')?.markAsTouched()"
          />
          <span class="error-message" *ngIf="temErro('cnpj')">
            {{ obterMensagemErro('cnpj') }}
          </span>
        </div>

        <div class="form-group" [class.has-error]="temErro('email')">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            formControlName="email"
            class="form-input"
            placeholder="contato@empresa.com"
            (blur)="form.get('email')?.markAsTouched()"
          />
          <span class="error-message" *ngIf="temErro('email')">
            {{ obterMensagemErro('email') }}
          </span>
        </div>
      </div>

      <div class="form-group">
        <label for="telefone">Telefone</label>
        <input
          type="tel"
          id="telefone"
          formControlName="telefone"
          class="form-input"
          placeholder="(11) 99999-9999"
        />
      </div>
    </div>

    <!-- Tab: Endereço -->
    <div class="tab-content" data-tab="endereco">
      <div class="form-group">
        <label for="logradouro">Logradouro</label>
        <input
          type="text"
          id="logradouro"
          formControlName="logradouro"
          class="form-input"
          placeholder="Ex: Rua das Flores"
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="numero">Número</label>
          <input
            type="text"
            id="numero"
            formControlName="numero"
            class="form-input"
            placeholder="123"
          />
        </div>
        <div class="form-group">
          <label for="complemento">Complemento</label>
          <input
            type="text"
            id="complemento"
            formControlName="complemento"
            class="form-input"
            placeholder="Apto 45"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="bairro">Bairro</label>
          <input
            type="text"
            id="bairro"
            formControlName="bairro"
            class="form-input"
            placeholder="Centro"
          />
        </div>
        <div class="form-group">
          <label for="cidade">Cidade</label>
          <input
            type="text"
            id="cidade"
            formControlName="cidade"
            class="form-input"
            placeholder="São Paulo"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="estado">Estado</label>
          <select
            id="estado"
            formControlName="estado"
            class="form-input"
          >
            <option value="">Selecione</option>
            <option *ngFor="let estado of estados" [value]="estado">{{ estado }}</option>
          </select>
        </div>
        <div class="form-group">
          <label for="cep">CEP</label>
          <input
            type="text"
            id="cep"
            formControlName="cep"
            class="form-input"
            placeholder="12345-678"
          />
        </div>
      </div>
    </div>

    <!-- Tab: Fiscal -->
    <div class="tab-content" data-tab="fiscal">
      <div class="form-row">
        <div class="form-group">
          <label for="inscricaoEstadual">Inscrição Estadual</label>
          <input
            type="text"
            id="inscricaoEstadual"
            formControlName="inscricaoEstadual"
            class="form-input"
          />
        </div>
        <div class="form-group">
          <label for="inscricaoMunicipal">Inscrição Municipal</label>
          <input
            type="text"
            id="inscricaoMunicipal"
            formControlName="inscricaoMunicipal"
            class="form-input"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="regimeEscal">Regime Fiscal</label>
          <select
            id="regimeEscal"
            formControlName="regimeEscal"
            class="form-input"
          >
            <option *ngFor="let regime of regimes" [value]="regime">{{ regime }}</option>
          </select>
        </div>
        <div class="form-group">
          <label for="tipoContribuinte">Tipo Contribuinte</label>
          <select
            id="tipoContribuinte"
            formControlName="tipoContribuinte"
            class="form-input"
          >
            <option *ngFor="let tipo of tiposContribuinte" [value]="tipo">{{ tipo }}</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="faturamentoAnual">Faturamento Anual (R$)</label>
        <input
          type="number"
          id="faturamentoAnual"
          formControlName="faturamentoAnual"
          class="form-input"
          min="0"
          step="0.01"
        />
      </div>
    </div>

    <!-- Tab: Responsável -->
    <div class="tab-content" data-tab="responsavel">
      <div class="form-group">
        <label for="responsavelNome">Nome do Responsável</label>
        <input
          type="text"
          id="responsavelNome"
          formControlName="responsavelNome"
          class="form-input"
          placeholder="Seu Nome"
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="responsavelCPF">CPF</label>
          <input
            type="text"
            id="responsavelCPF"
            formControlName="responsavelCPF"
            class="form-input"
            placeholder="000.000.000-00"
          />
        </div>
        <div class="form-group">
          <label for="responsavelEmail">Email</label>
          <input
            type="email"
            id="responsavelEmail"
            formControlName="responsavelEmail"
            class="form-input"
            placeholder="seu@email.com"
          />
        </div>
      </div>

      <div class="form-group">
        <label for="responsavelTelefone">Telefone</label>
        <input
          type="tel"
          id="responsavelTelefone"
          formControlName="responsavelTelefone"
          class="form-input"
          placeholder="(11) 99999-9999"
        />
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn-secondary" (click)="cancelar()">Cancelar</button>
      <button type="submit" class="btn-primary" [disabled]="!form.valid || enviando">
        {{ enviando ? 'Salvando...' : 'Salvar' }}
      </button>
    </div>
  </form>
</div>
