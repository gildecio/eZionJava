<div class="empresas-container">
  <div class="empresas-header">
    <h1 class="empresas-title">Empresas</h1>
    <button class="btn-primary" (click)="abrirModalCriar()">+ Nova Empresa</button>
  </div>

  <!-- Filtros -->
  <div class="filtros">
    <h5>Filtros</h5>
  </div>

  <!-- Tabela de Empresas -->
  <div class="empresas-table-wrapper">
    <div *ngIf="carregando" class="loading">
      <div class="spinner"></div>
      <p>Carregando empresas...</p>
    </div>

    <table class="empresas-table" *ngIf="!carregando && empresas.length > 0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Razão Social</th>
          <th>Nome Fantasia</th>
          <th>CNPJ</th>
          <th>Email</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let empresa of empresas">
          <td>{{ empresa.id }}</td>
          <td><strong>{{ empresa.razaoSocial }}</strong></td>
          <td>{{ empresa.nomeFantasia }}</td>
          <td>{{ empresa.cnpj }}</td>
          <td>{{ empresa.email || '-' }}</td>
          <td>
            <span class="status-badge" [class.ativa]="empresa.ativa" [class.inativa]="!empresa.ativa">
              {{ empresa.ativa ? 'Ativa' : 'Inativa' }}
            </span>
          </td>
          <td class="actions">
            <button class="btn-icon btn-edit" (click)="abrirModalEditar(empresa)" title="Editar">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
              </svg>
            </button>
            <button 
              *ngIf="empresa.ativa"
              class="btn-icon btn-deactivate" 
              (click)="desativarEmpresa(empresa.id!)" 
              title="Desativar">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 17 21 12 16 7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
              </svg>
            </button>
            <button 
              *ngIf="!empresa.ativa"
              class="btn-icon btn-activate" 
              (click)="ativarEmpresa(empresa.id!)" 
              title="Ativar">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 7 21 12 16 17"/>
                <line x1="9" y1="12" x2="21" y2="12"/>
              </svg>
            </button>
            <button class="btn-icon btn-delete" (click)="deletarEmpresa(empresa.id!)" title="Deletar">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!carregando && empresas.length === 0" class="empty-state">
      <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
      </svg>
      <p>Nenhuma empresa encontrada</p>
      <small>Comece criando uma nova empresa</small>
    </div>
  </div>

  <!-- Modal de Criação/Edição -->
  <div class="modal" [class.active]="modalAberto">
    <div class="modal-content">
      <div class="modal-header">
        <h2>{{ editandoId ? 'Editar Empresa' : 'Nova Empresa' }}</h2>
        <button class="btn-close" (click)="fecharModal()">&times;</button>
      </div>
      <form (ngSubmit)="salvar()" #form="ngForm" class="modal-form">
        
        <!-- Abas de formulário -->
        <div class="form-tabs">
          <button type="button" class="tab-btn active" data-tab="dados-basicos" (click)="mudarAba('dados-basicos')">Dados Básicos</button>
          <button type="button" class="tab-btn" data-tab="endereco" (click)="mudarAba('endereco')">Endereço</button>
          <button type="button" class="tab-btn" data-tab="fiscal" (click)="mudarAba('fiscal')">Fiscal</button>
          <button type="button" class="tab-btn" data-tab="responsavel" (click)="mudarAba('responsavel')">Responsável</button>
        </div>

        <!-- Tab: Dados Básicos -->
        <div class="tab-content active" data-tab="dados-basicos">
          <div class="form-group">
            <label for="razaoSocial">Razão Social *</label>
            <input
              type="text"
              id="razaoSocial"
              name="razaoSocial"
              [(ngModel)]="empresaForm.razaoSocial"
              required
              class="form-input"
              placeholder="Ex: Empresa LTDA"
            />
          </div>
          <div class="form-group">
            <label for="nomeFantasia">Nome Fantasia *</label>
            <input
              type="text"
              id="nomeFantasia"
              name="nomeFantasia"
              [(ngModel)]="empresaForm.nomeFantasia"
              required
              class="form-input"
              placeholder="Ex: Minha Empresa"
            />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="cnpj">CNPJ *</label>
              <input
                type="text"
                id="cnpj"
                name="cnpj"
                [(ngModel)]="empresaForm.cnpj"
                required
                class="form-input"
                placeholder="00.000.000/0000-00"
              />
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input
                type="email"
                id="email"
                name="email"
                [(ngModel)]="empresaForm.email"
                class="form-input"
                placeholder="contato@empresa.com"
              />
            </div>
          </div>
          <div class="form-group">
            <label for="telefone">Telefone</label>
            <input
              type="tel"
              id="telefone"
              name="telefone"
              [(ngModel)]="empresaForm.telefone"
              class="form-input"
              placeholder="(11) 99999-9999"
            />
          </div>
        </div>

        <!-- Tab: Endereço -->
        <div class="tab-content" data-tab="endereco">
          <div class="form-group">
            <label for="logradouro">Logradouro</label>
            <input
              type="text"
              id="logradouro"
              name="logradouro"
              [(ngModel)]="empresaForm.logradouro"
              class="form-input"
              placeholder="Ex: Rua das Flores"
            />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="numero">Número</label>
              <input
                type="text"
                id="numero"
                name="numero"
                [(ngModel)]="empresaForm.numero"
                class="form-input"
                placeholder="123"
              />
            </div>
            <div class="form-group">
              <label for="complemento">Complemento</label>
              <input
                type="text"
                id="complemento"
                name="complemento"
                [(ngModel)]="empresaForm.complemento"
                class="form-input"
                placeholder="Apto 45"
              />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="bairro">Bairro</label>
              <input
                type="text"
                id="bairro"
                name="bairro"
                [(ngModel)]="empresaForm.bairro"
                class="form-input"
                placeholder="Centro"
              />
            </div>
            <div class="form-group">
              <label for="cidade">Cidade</label>
              <input
                type="text"
                id="cidade"
                name="cidade"
                [(ngModel)]="empresaForm.cidade"
                class="form-input"
                placeholder="São Paulo"
              />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="estado">Estado</label>
              <select
                id="estado"
                name="estado"
                [(ngModel)]="empresaForm.estado"
                class="form-input"
              >
                <option value="">Selecione</option>
                <option *ngFor="let estado of estados" [value]="estado">{{ estado }}</option>
              </select>
            </div>
            <div class="form-group">
              <label for="cep">CEP</label>
              <input
                type="text"
                id="cep"
                name="cep"
                [(ngModel)]="empresaForm.cep"
                class="form-input"
                placeholder="12345-678"
              />
            </div>
          </div>
        </div>

        <!-- Tab: Fiscal -->
        <div class="tab-content" data-tab="fiscal">
          <div class="form-row">
            <div class="form-group">
              <label for="inscricaoEstadual">Inscrição Estadual</label>
              <input
                type="text"
                id="inscricaoEstadual"
                name="inscricaoEstadual"
                [(ngModel)]="empresaForm.inscricaoEstadual"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label for="inscricaoMunicipal">Inscrição Municipal</label>
              <input
                type="text"
                id="inscricaoMunicipal"
                name="inscricaoMunicipal"
                [(ngModel)]="empresaForm.inscricaoMunicipal"
                class="form-input"
              />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="regimeEscal">Regime Fiscal</label>
              <select
                id="regimeEscal"
                name="regimeEscal"
                [(ngModel)]="empresaForm.regimeEscal"
                class="form-input"
              >
                <option *ngFor="let regime of regimes" [value]="regime">{{ regime }}</option>
              </select>
            </div>
            <div class="form-group">
              <label for="tipoContribuinte">Tipo Contribuinte</label>
              <select
                id="tipoContribuinte"
                name="tipoContribuinte"
                [(ngModel)]="empresaForm.tipoContribuinte"
                class="form-input"
              >
                <option *ngFor="let tipo of tiposContribuinte" [value]="tipo">{{ tipo }}</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="faturamentoAnual">Faturamento Anual (R$)</label>
            <input
              type="number"
              id="faturamentoAnual"
              name="faturamentoAnual"
              [(ngModel)]="empresaForm.faturamentoAnual"
              class="form-input"
              min="0"
              step="0.01"
            />
          </div>
        </div>

        <!-- Tab: Responsável -->
        <div class="tab-content" data-tab="responsavel">
          <div class="form-group">
            <label for="responsavelNome">Nome do Responsável</label>
            <input
              type="text"
              id="responsavelNome"
              name="responsavelNome"
              [(ngModel)]="empresaForm.responsavelNome"
              class="form-input"
              placeholder="Seu Nome"
            />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="responsavelCPF">CPF</label>
              <input
                type="text"
                id="responsavelCPF"
                name="responsavelCPF"
                [(ngModel)]="empresaForm.responsavelCPF"
                class="form-input"
                placeholder="000.000.000-00"
              />
            </div>
            <div class="form-group">
              <label for="responsavelEmail">Email</label>
              <input
                type="email"
                id="responsavelEmail"
                name="responsavelEmail"
                [(ngModel)]="empresaForm.responsavelEmail"
                class="form-input"
                placeholder="seu@email.com"
              />
            </div>
          </div>
          <div class="form-group">
            <label for="responsavelTelefone">Telefone</label>
            <input
              type="tel"
              id="responsavelTelefone"
              name="responsavelTelefone"
              [(ngModel)]="empresaForm.responsavelTelefone"
              class="form-input"
              placeholder="(11) 99999-9999"
            />
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="fecharModal()">Cancelar</button>
          <button type="submit" class="btn-primary" [disabled]="!form.valid || enviando">
            {{ enviando ? 'Salvando...' : 'Salvar' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Overlay do Modal -->
  <div class="modal-overlay" [class.active]="modalAberto" (click)="fecharModal()"></div>
</div>
