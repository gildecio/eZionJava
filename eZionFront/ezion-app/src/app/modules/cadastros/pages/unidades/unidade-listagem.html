<div class="unidades-container">
  <!-- Diálogo de Confirmação -->
  <app-confirm-dialog
    [visible]="confirmDialogVisible"
    [title]="confirmDialogTitle"
    [message]="confirmDialogMessage"
    [confirmLabel]="confirmDialogLabel"
    (confirmed)="onConfirmDialogConfirmed()"
    (cancelled)="onConfirmDialogCancelled()"
  ></app-confirm-dialog>

  <div class="unidades-header">
    <h1 class="unidades-title">Unidades</h1>
    <button class="btn-primary" (click)="onNovaUnidade()">+ Nova Unidade</button>
  </div>

  <!-- Filtros -->
  <div class="filtros">
    <button class="btn-primary" (click)="carregarUnidades()">Consultar</button>
  </div>

  <!-- Tabela de Unidades -->
  <div class="unidades-table-wrapper">
    <div *ngIf="carregando()" class="loading">
      <div class="spinner"></div>
      <p>Carregando unidades...</p>
    </div>

    <table class="unidades-table" *ngIf="!carregando() && unidadesFiltradas().length">
      <thead>
        <tr>
          <th>ID</th>
          <th>Sigla</th>
          <th>Descrição</th>
          <th>Fator</th>
          <th>Unidade Pai</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let unidade of unidadesFiltradas()">
          <td>{{ unidade.id }}</td>
          <td><strong>{{ unidade.sigla }}</strong></td>
          <td>{{ unidade.descricao }}</td>
          <td>{{ unidade.fator || '-' }}</td>
          <td>{{ unidade.unidadePai?.sigla || '-' }}</td>
          <td>
            <span class="status-badge" [class.ativa]="unidade.ativo" [class.inativa]="!unidade.ativo">
              {{ unidade.ativo ? 'Ativa' : 'Inativa' }}
            </span>
          </td>
          <td class="acoes">
            <button
              pButton
              type="button"
              [rounded]="true"
              [text]="true"
              icon="pi pi-eye"
              pTooltip="Visualizar"
              tooltipPosition="top"
              (click)="onVisualizarUnidade(unidade)"
              class="p-button-sm p-button-secondary"
            ></button>
            <button
              pButton
              type="button"
              [rounded]="true"
              [text]="true"
              icon="pi pi-pencil"
              pTooltip="Editar"
              tooltipPosition="top"
              (click)="onEditarUnidade(unidade)"
              class="p-button-sm p-button-info"
            ></button>
            <button
              pButton
              type="button"
              [rounded]="true"
              [text]="true"
              icon="pi pi-trash"
              pTooltip="Excluir"
              tooltipPosition="top"
              (click)="deletarUnidade(unidade.id!)"
              class="p-button-sm p-button-danger"
            ></button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!carregando() && !unidadesFiltradas().length" class="empty-state">
      <div class="empty-icon">
        <i class="pi pi-box"></i>
      </div>
      <h3>Nenhuma unidade encontrada</h3>
      <p>Clique em "Consultar" para carregar as unidades ou "Nova Unidade" para adicionar uma.</p>
    </div>
  </div>
</div>